Kit.define("qrlogin",{loading:!1,mask:!1,spinner:!1,image:0[0],async connect(api="/api/login/qrcode?next=/account"){this.api=api,this.timeout&&clearTimeout(this.timeout),this.eventSource&&this.eventSource.close(),this.loading=!0,this.spinner=!0,this.mask=!1;try{const res=await fetch(api),{success,data}=await res.json();if(!success)return;const{svg,expiration,listen}=data;this.image=svg,this.loading=!1;let now=new Date,expirate=new Date(expiration),remaining=expirate.getTime()-now.getTime();this.timeout=setTimeout(()=>{this.loading=!0,this.mask=!0,this.spinner=!1,this.expiration=null,this.eventSource&&this.eventSource.close()},remaining),this.eventSource=new EventSource(listen),this.eventSource.onmessage=async event=>{try{const resp=await fetch(event.data),{success,redirect}=await resp.json();success&&redirect&&location.assign(redirect),this.eventSource.close()}catch(err){console.error("QR Code auth error:",err)}},this.eventSource.onerror=err=>{console.error("EventSource failed:",err)}}catch(error){console.error("Failed to fetch QR code:",error)}},refresh(){this.connect(this.api)}})