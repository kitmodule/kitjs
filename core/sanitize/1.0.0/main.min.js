(function(global){const kitmodule=global.kitmodule||(global.kitmodule={}),defaultAllowedTags=["b","i","em","strong","a","p","br","ul","ol","li","span","div","img","h1","h2","h3","h4","h5","h6","table","thead","tbody","tr","td","th","blockquote","code","pre"],defaultAllowedAttributes={a:["href","title","target","rel"],img:["src","alt","title","width","height"],"*":["class","id","style"]},forbiddenTags=["script","style","iframe","object","embed","link","meta"];function kitSanitize(inputHTML,options={}){const allowedTags=options.allowedTags||defaultAllowedTags,allowedAttributes=options.allowedAttributes||defaultAllowedAttributes,parser=new DOMParser,doc=parser.parseFromString(inputHTML,"text/html");function isSafeUrl(url){if(!url)return!1;const safeProtocols=["http:","https:","mailto:","tel:"];try{const parsed=new URL(url,location.origin);return safeProtocols.includes(parsed.protocol)}catch{return!1}}function cleanNode(node){let child=node.firstChild;for(;child;){const next=child.nextSibling;if(child.nodeType===Node.ELEMENT_NODE){const tagName=child.tagName.toLowerCase();forbiddenTags.includes(tagName)||!allowedTags.includes(tagName)?child.remove():([...child.attributes].forEach(attr=>{const attrName=attr.name.toLowerCase(),allowedForTag=allowedAttributes[tagName]||[],allowedForAll=allowedAttributes["*"]||[];if(![...allowedForTag,...allowedForAll].includes(attrName)){child.removeAttribute(attr.name);return}if(attrName.startsWith("on")){child.removeAttribute(attr.name);return}if(attrName==="style"){child.removeAttribute(attr.name);return}if((attrName==="href"||attrName==="src")&&!isSafeUrl(attr.value)){child.removeAttribute(attr.name);return}if(tagName==="a"&&attrName==="target"&&attr.value==="_blank"){const rel=child.getAttribute("rel")||"";rel.includes("noopener")||child.setAttribute("rel",(rel+" noopener noreferrer").trim())}}),cleanNode(child))}else child.nodeType===Node.COMMENT_NODE?child.remove():child.nodeType!==Node.TEXT_NODE&&child.remove();child=next}}return cleanNode(doc.body),doc.body.innerHTML}kitmodule.sanitizeHTML=kitSanitize})(typeof window!="undefined"?window:globalThis)